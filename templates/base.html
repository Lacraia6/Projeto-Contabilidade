<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>{% block title %}Gerenciamento DP & Contabilidade{% endblock %}</title>

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for message in messages %}
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            showAlertModal("{{ message }}", 'info', 'Mensagem do Sistema');
          });
        </script>
      {% endfor %}
    {% endif %}
  {% endwith %}
  <div class="app-container">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <span class="sidebar-logo">
          <img src="{{ url_for('static', filename='logo.png') }}" alt="Contabilidade Santos">
        </span>
      </div>
      <ul class="nav-menu">
        {% if session.get('user_tipo') == 'normal' %}
        <li class="nav-item {% if aba == 'dashboard' %}active{% endif %}">
          <a href="{{ url_for('dashboard.return_dashboard') }}"><i class="fas fa-user-check"></i> Painel do Funcion√°rio</a>
        </li>
        <li class="nav-item {% if aba == 'checklist' %}active{% endif %}">
          <a href="{{ url_for('checklist.index') }}">
            <i class="fas fa-tasks"></i> Meus Checklists
            <!-- Badge que aparece apenas quando h√° checklists pendentes -->
            <span id="checklist-badge" class="notification-badge" style="display: none; visibility: hidden;">0</span>
          </a>
        </li>
        {% endif %}

        {% if session.get('user_tipo') == 'gerente' %}
        <li class="nav-item {% if aba == 'gerenciamento' %}active{% endif %}">
          <a href="{{ url_for('gerenciamento.return_page') }}"><i class="fas fa-users-cog"></i> Painel do Gerente</a>
        </li>
        <!-- <li class="nav-item {% if aba == 'empresas' %}active{% endif %}">
          <a href="{{ url_for('empresas.return_page') }}"><i class="fas fa-building"></i> Empresas</a>
        </li> -->
        <li class="nav-item {% if aba == 'tarefas' %}active{% endif %}">
          <a href="{{ url_for('tarefas_v2.pagina_atribuir') }}" id="link-tarefas-v2"><i class="fas fa-clipboard-list"></i> Atribuir Tarefas</a>
        </li>
        <li class="nav-item {% if aba == 'relatorios' %}active{% endif %}">
          <a href="{{ url_for('relatorios.return_page') }}"><i class="fas fa-chart-bar"></i> Relat√≥rios</a>
        </li>
        {% endif %}

        {% if session.get('user_tipo') == 'supervisor' %}
        <li class="nav-item {% if aba == 'supervisor' %}active{% endif %}">
          <a href="{{ url_for('supervisor.index') }}"><i class="fas fa-user-shield"></i> Painel do Supervisor</a>
        </li>
        {% endif %}

        {% if session.get('user_tipo') == 'admin' %}
        <li class="nav-item {% if aba == 'admin' %}active{% endif %}">
          <a href="{{ url_for('admin.admin_page') }}"><i class="fas fa-toolbox"></i> Administra√ß√£o</a>
        </li>
        {% endif %}

        {% if session.get('user_id') %}
        <li class="nav-item">
          <a href="{{ url_for('auth.logout') }}"><i class="fas fa-right-from-bracket"></i> Sair</a>
        </li>
        {% endif %}
      </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- Modal de Alerta Personalizado -->
  <div id="alertModal" class="alert-modal">
    <div class="alert-modal-content">
      <div class="alert-modal-header" id="alertModalHeader">
        <i class="alert-modal-icon" id="alertModalIcon"></i>
        <h3 class="alert-modal-title" id="alertModalTitle">Alerta</h3>
      </div>
      <div class="alert-modal-body" id="alertModalBody">
        <!-- Conte√∫do da mensagem ser√° inserido aqui -->
      </div>
      <div class="alert-modal-footer">
        <button class="alert-modal-btn alert-modal-btn-primary" id="alertModalBtn" onclick="closeAlertModal()">
          OK
        </button>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Script para for√ßar clicabilidade -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üîß For√ßando clicabilidade dos elementos...');
      
      // Fun√ß√£o para for√ßar clicabilidade
      function forceClickability() {
        // For√ßar clicabilidade em todos os links
        const allLinks = document.querySelectorAll('a');
        allLinks.forEach(link => {
          link.style.pointerEvents = 'auto';
          link.style.cursor = 'pointer';
          link.style.zIndex = '999';
        });
        
        // For√ßar clicabilidade em todos os bot√µes
        const allButtons = document.querySelectorAll('button, .btn');
        allButtons.forEach(button => {
          button.style.pointerEvents = 'auto';
          button.style.cursor = 'pointer';
          button.style.zIndex = '999';
        });
        
        // For√ßar clicabilidade no sidebar
        const sidebar = document.querySelector('.sidebar');
        if (sidebar) {
          sidebar.style.pointerEvents = 'auto';
          sidebar.style.zIndex = '1000';
        }
        
        // For√ßar clicabilidade nos itens de navega√ß√£o
        const navItems = document.querySelectorAll('.nav-item, .nav-item a');
        navItems.forEach(item => {
          item.style.pointerEvents = 'auto';
          item.style.cursor = 'pointer';
          item.style.zIndex = '1001';
        });
        
        console.log(`‚úÖ For√ßada clicabilidade em ${allLinks.length} links e ${allButtons.length} bot√µes`);
      }
      
      // Executar imediatamente
      forceClickability();
      
      // Executar novamente ap√≥s um delay
      setTimeout(forceClickability, 1000);
      
      // Executar quando a janela carregar completamente
      window.addEventListener('load', forceClickability);
      
      // Verificar se h√° elementos sobrepondo
      const sidebar = document.querySelector('.sidebar');
      const mainContent = document.querySelector('.main-content');
      
      if (sidebar) {
        console.log('‚úÖ Sidebar encontrado');
        console.log(`   Z-index: ${getComputedStyle(sidebar).zIndex}`);
        console.log(`   Pointer-events: ${getComputedStyle(sidebar).pointerEvents}`);
      }
      
      if (mainContent) {
        console.log('‚úÖ Main content encontrado');
        console.log(`   Z-index: ${getComputedStyle(mainContent).zIndex}`);
        console.log(`   Pointer-events: ${getComputedStyle(mainContent).pointerEvents}`);
      }
      
      console.log('‚úÖ Script de clicabilidade carregado');
      console.log('‚úÖ Scripts problem√°ticos removidos');
      
      // For√ßar atualiza√ß√£o do link de tarefas para V2
      const linkTarefasV2 = document.getElementById('link-tarefas-v2');
      if (linkTarefasV2) {
        linkTarefasV2.href = '/tarefas-v2/';
        linkTarefasV2.onclick = function(e) {
          e.preventDefault();
          window.location.href = '/tarefas-v2/';
          return false;
        };
        console.log('‚úÖ Link de tarefas V2 configurado:', linkTarefasV2.href);
      } else {
        console.warn('‚ö†Ô∏è Link de tarefas V2 n√£o encontrado no DOM');
      }
    });
  </script>
</body>
</html>
